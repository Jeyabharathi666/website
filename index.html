<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Live Sheet Dashboard</title>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #f5f7fb;
}

header {
  background: linear-gradient(90deg, #0f172a, #020617);
  color: #fff;
  padding: 16px 28px;
  font-size: 20px;
  font-weight: 600;
}

.container {
  max-width: 1300px;
  margin: 20px auto;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  padding: 20px;
}

.toolbar {
  display: flex;
  justify-content: space-between;
  margin-bottom: 12px;
}

.search {
  width: 260px;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
}

.badge {
  background: #2563eb;
  color: #fff;
  padding: 6px 12px;
  border-radius: 999px;
  font-size: 13px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead th {
  position: sticky;
  top: 0;
  background: #f8fafc;
  padding: 12px;
  border-bottom: 1px solid #e5e7eb;
}

tbody td {
  padding: 10px;
  border-bottom: 1px solid #eef2f7;
}

tbody tr:hover {
  background: #f1f5f9;
}

.stars {
  color: #facc15;
  font-size: 16px;
}

.footer {
  text-align: center;
  font-size: 12px;
  color: #64748b;
  margin-top: 10px;
}
</style>
</head>

<body>

<header>ðŸ“Š Live Sheet Dashboard</header>

<!-- ================= BONDS ================= -->
<div class="container">
<h2>Secured Bonds</h2>
<div class="toolbar">
<input id="searchBonds" class="search" placeholder="Search Bonds">
<span id="rowCountBonds" class="badge">0 rows</span>
</div>

<table>
<thead>
<tr>
<th>Bond Name</th><th>Rating</th><th>Maturity</th>
<th>Interest Pay</th><th>YTM</th><th>Price</th>
</tr>
</thead>
<tbody id="tableBodyBonds"></tbody>
</table>
</div>

<!-- ================= CORE ================= -->
<div class="container">
<h2>Core Stocks</h2>
<div class="toolbar">
<input id="searchCore" class="search" placeholder="Search Core">
<span id="rowCountCore" class="badge">0 rows</span>
</div>

<table>
<thead>
<tr>
<th>NSE</th><th>DCHG</th><th>CMP</th><th>Weightage</th>
<th>Book</th><th>TGT</th><th>PE</th>
<th>Bonus</th><th>Div</th><th>Facevalue</th>
<th>M-CAL</th><th>D-CAL</th>
</tr>
</thead>
<tbody id="tableBodyCore"></tbody>
</table>
</div>

<!-- ================= ADDITIONAL ================= -->
<div class="container">
<h2>Additional Stocks</h2>
<div class="toolbar">
<input id="searchAdd" class="search" placeholder="Search Additional">
<span id="rowCountAdd" class="badge">0 rows</span>
</div>

<table>
<thead>
<tr>
<th>NSE</th><th>DCHG</th><th>CMP</th><th>Weightage</th>
<th>Book</th><th>TGT</th><th>PE</th>
<th>Bonus</th><th>Div</th><th>Facevalue</th>
<th>M-CAL</th><th>D-CAL</th>
</tr>
</thead>
<tbody id="tableBodyAdd"></tbody>
</table>
</div>

<!-- ================= EVERGREEN ================= -->
<div class="container">
<h2>Evergreen Stocks</h2>

<table>
<thead>
<tr>
<th>NSE</th><th>DCHG</th><th>CMP</th><th>Bookvalue</th>
<th>PE</th><th>Bonus</th><th>Div</th>
<th>Facevalue</th><th>M-CAL</th><th>D-CAL</th>
</tr>
</thead>
<tbody id="tableBodyEver"></tbody>
</table>
</div>

<script>
// ===== STAR LOGIC =====
function weightToStars(v){
  v = parseInt(v,10);
  if(isNaN(v)) return "-";
  if(v<=3) return "â­";
  if(v<=6) return "â­â­";
  if(v<=9) return "â­â­â­";
  if(v<=12) return "â­â­â­â­";
  return "â­â­â­â­â­";
}

// ===== CSV PARSER (for â‚¹ commas) =====
function parseCSVLine(line){
  let res=[],cur="",q=false;
  for(let c of line){
    if(c=='"') q=!q;
    else if(c==","&&!q){res.push(cur.trim());cur="";}
    else cur+=c;
  }
  res.push(cur.trim());
  return res;
}

// ===== GENERIC STOCK LOADER =====
async function loadStock(csv, body, map, count){
  const t = await (await fetch(csv+"&t="+Date.now())).text();
  const rows = t.split("\n").slice(1);
  body.innerHTML="";
  rows.forEach(r=>{
    if(!r.trim()) return;
    const c=r.split(",");
    const tr=document.createElement("tr");
    tr.innerHTML=map(c);
    body.appendChild(tr);
  });
  if(count) count.innerText=body.children.length+" rows";
}

// ===== LOAD BONDS =====
async function loadBonds(){
  const t=await (await fetch(
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTnH2pXuMnGI1RDWNwWOIcLVX9yoXGGps-nV9YCoqaNOr0ZT3e-oCpgFkxio8DnxNTfoQf8NYdfz545/pub?gid=499477798&single=true&output=csv&t="+Date.now()
)).text();

  const rows=t.split("\n").slice(1);
  const b=document.getElementById("tableBodyBonds");
  b.innerHTML="";
  rows.forEach(r=>{
    const c=parseCSVLine(r);
    if(!c[0]) return;
    b.innerHTML+=`
    <tr><td>${c[0]}</td><td>${c[1]}</td><td>${c[2]}</td>
    <td>${c[3]}</td><td>${c[4]}</td><td>${c[5]}</td></tr>`;
  });
  document.getElementById("rowCountBonds").innerText=b.children.length+" rows";
}

// ===== CORE =====
loadStock(
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTMii4ujWUq6_wBkZaryA1LFhb4Dkw81NUaJju0kkmJzlcPV0SvNo8HzL1C7hSSZq5V-ZpnWdNLf_fe/pub?gid=1284854745&single=true&output=csv",
document.getElementById("tableBodyCore"),
c=>`
<td>${c[1]}</td><td>${c[2]}</td><td>${c[3]}</td>
<td class="stars">${weightToStars(c[5])}</td>
<td>${c[4]}</td><td>${c[6]}</td><td>${c[7]}</td>
<td>${c[8]}</td><td>${c[9]}</td><td>${c[10]}</td>
<td>${c[11]}</td><td>${c[12]}</td>
`,
document.getElementById("rowCountCore")
);

// ===== ADDITIONAL =====
loadStock(
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTMii4ujWUq6_wBkZaryA1LFhb4Dkw81NUaJju0kkmJzlcPV0SvNo8HzL1C7hSSZq5V-ZpnWdNLf_fe/pub?gid=255801000&single=true&output=csv",
document.getElementById("tableBodyAdd"),
c=>`
<td>${c[1]}</td><td>${c[2]}</td><td>${c[3]}</td>
<td class="stars">${weightToStars(c[5])}</td>
<td>${c[4]}</td><td>${c[6]}</td><td>${c[7]}</td>
<td>${c[8]}</td><td>${c[9]}</td><td>${c[10]}</td>
<td>${c[11]}</td><td>${c[12]}</td>
`,
document.getElementById("rowCountAdd")
);

// ===== EVERGREEN =====
loadStock(
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTMii4ujWUq6_wBkZaryA1LFhb4Dkw81NUaJju0kkmJzlcPV0SvNo8HzL1C7hSSZq5V-ZpnWdNLf_fe/pub?gid=492196644&single=true&output=csv",
document.getElementById("tableBodyEver"),
c=>`
<td>${c[1]}</td><td>${c[2]}</td><td>${c[3]}</td>
<td>${c[4]}</td><td>${c[5]}</td><td>${c[6]}</td>
<td>${c[7]}</td><td>${c[8]}</td><td>${c[9]}</td><td>${c[10]}</td>
`
);

// ===== INIT =====
loadBonds();
setInterval(loadBonds,1800000);
</script>

</body>
</html>
