<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Live Sheet Dashboard</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background: #f5f7fb;
  }

  header {
    background: linear-gradient(90deg, #0f172a, #020617);
    color: #fff;
    padding: 16px 28px;
    font-size: 20px;
    font-weight: 600;
  }

  .container {
    max-width: 1300px;
    margin: 20px auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    padding: 20px;
  }

  .toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
  }

  .search {
    width: 260px;
    padding: 10px 14px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    font-size: 14px;
  }

  .badge {
    background: #2563eb;
    color: white;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead th {
    position: sticky;
    top: 0;
    background: #f8fafc;
    font-size: 14px;
    padding: 12px 14px;
    border-bottom: 1px solid #e5e7eb;
    text-align: left;
  }

  tbody td {
    padding: 12px 14px;
    border-bottom: 1px solid #eef2f7;
    font-size: 14px;
  }

  tbody tr:hover {
    background: #f1f5f9;
  }

  .footer {
    text-align: center;
    font-size: 12px;
    color: #64748b;
    margin-top: 16px;
  }

  /* ===== COLOR SCALES ===== */

  /* Green (M-S1 â†’ M-S4) */
  .m-s1 { color: #4ade80; font-weight: 600; }
  .m-s2 { color: #4ade80; font-weight: 600; }
  .m-s3 { color: #4ade80; font-weight: 600; }
  .m-s4 { color: #4ade80; font-weight: 600; }

  /* Blue (others) */
  .m-b1 { color: #93c5fd; font-weight: 600; }
  .m-b2 { color: #93c5fd; font-weight: 600; }
  .m-b3 { color: #93c5fd; font-weight: 600; }
  .m-b4 { color: #93c5fd; font-weight: 600; }

</style>
</head>

<body>

<header>ðŸ“Š Live Sheet Dashboard</header>

<div class="container">

  <div class="toolbar">
    <input id="search" class="search" placeholder="ðŸ” Search NSE / Analyse..." />
    <span id="rowCount" class="badge">0 rows</span>
  </div>

  <table>
    <thead>
      <tr>
        <th>NSE CODE</th>
        <th>DCHG</th>
        <th>CMP</th>
        <th>Weightage</th>
        <th>Tgt-I</th>
        <th>Tgt-II</th>
        <th>M-Res/Sup</th>
        <th>D-Res/Sup</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="footer">
    Auto-refresh every 60 seconds Â· Powered by Google Sheets
  </div>

</div>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTMii4ujWUq6_wBkZaryA1LFhb4Dkw81NUaJju0kkmJzlcPV0SvNo8HzL1C7hSSZq5V-ZpnWdNLf_fe/pub?gid=971694303&single=true&output=csv";

const tableBody = document.getElementById("tableBody");
const rowCount = document.getElementById("rowCount");
const searchBox = document.getElementById("search");

async function loadData() {
  const res = await fetch(CSV_URL + "&t=" + Date.now());
  const text = await res.text();

  const rows = text.split("\n").slice(1);
  tableBody.innerHTML = "";

  rows.forEach(row => {
    const c = row.split(",");

    if (!c[1]) return; // skip empty NSE

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${c[1] || "-"}</td>   <!-- B NSE -->
      <td>${c[2] || "-"}</td>   <!-- C DCHG -->
      <td>${c[3] || "-"}</td>   <!-- D CMP -->
      <td>${c[4] || "-"}</td>   <!-- E Weightage -->
      <td>${c[7] || "-"}</td>   <!-- H Tgt-I -->
      <td>${c[9] || "-"}</td>   <!-- J Tgt-II -->
      <td>${c[23] || "-"}</td>  <!-- X M-Res/Sup -->
      <td>${c[24] || "-"}</td>  <!-- Y D-Res/Sup -->
    `;

    /* M-RES/SUP COLOR */
    const mCell = tr.children[6];
    const val = mCell.innerText.toUpperCase();

    if (val.includes("M-S1")) mCell.className = "m-s1";
    else if (val.includes("M-S2")) mCell.className = "m-s2";
    else if (val.includes("M-S3")) mCell.className = "m-s3";
    else if (val.includes("M-S4")) mCell.className = "m-s4";
    else if (val.includes("1")) mCell.className = "m-b1";
    else if (val.includes("2")) mCell.className = "m-b2";
    else if (val.includes("3")) mCell.className = "m-b3";
    else mCell.className = "m-b4";

    tableBody.appendChild(tr);
  });

  rowCount.innerText = tableBody.children.length + " rows";
}

searchBox.addEventListener("input", () => {
  const q = searchBox.value.toLowerCase();
  [...tableBody.rows].forEach(r => {
    r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none";
  });
});

loadData();
setInterval(loadData, 1800000);
</script>

</body>
</html>
