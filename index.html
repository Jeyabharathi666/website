<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Live Sheet Dashboard</title>

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background: #f5f7fb;
  }

  header {
    background: linear-gradient(90deg, #0f172a, #020617);
    color: #fff;
    padding: 16px 28px;
    font-size: 20px;
    font-weight: 600;
  }

  .container {
    max-width: 1200px;
    margin: 20px auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    padding: 20px;
  }

  .toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
  }

  .search {
    width: 260px;
    padding: 10px 14px;
    border-radius: 8px;
    border: 1px solid #d1d5db;
    font-size: 14px;
  }

  .badge {
    background: #2563eb;
    color: white;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 13px;
    font-weight: 600;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead th {
    position: sticky;
    top: 0;
    background: #f8fafc;
    font-size: 14px;
    text-align: left;
    padding: 12px 16px;
    border-bottom: 1px solid #e5e7eb;
  }

  tbody td {
    padding: 12px 16px;
    border-bottom: 1px solid #eef2f7;
    font-size: 14px;
  }

  tbody tr:hover {
    background: #f1f5f9;
  }

  .footer {
    text-align: center;
    font-size: 12px;
    color: #64748b;
    margin-top: 16px;
  }

  .m-green { color: #16a34a; font-weight: 600; }
  .m-blue { color: #2563eb; font-weight: 600; }
  .m-yellow { color: #ca8a04; font-weight: 600; }
  .m-red { color: #dc2626; font-weight: 600; }

</style>
</head>

<body>

<header>ðŸ“Š Live Sheet Dashboard</header>

<div class="container">

  <div class="toolbar">
    <input id="search" class="search" placeholder="ðŸ” Search NSE / Analyse..." />
    <span id="rowCount" class="badge">0 rows</span>
  </div>

  <table>
    <thead>
      <tr>
        <th>NSE CODE</th>
        <th>Analyse</th>
        <th>M-CAL</th>
        <th>D-CAL</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="footer">
    Auto-refresh every 60 seconds Â· Powered by Google Sheets
  </div>

</div>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vTMii4ujWUq6_wBkZaryA1LFhb4Dkw81NUaJju0kkmJzlcPV0SvNo8HzL1C7hSSZq5V-ZpnWdNLf_fe/pub?gid=971694303&single=true&output=csv";

const tableBody = document.getElementById("tableBody");
const rowCount = document.getElementById("rowCount");
const searchBox = document.getElementById("search");

async function loadData() {
  const res = await fetch(CSV_URL + "&t=" + Date.now());
  const text = await res.text();

  const rows = text.split("\n").slice(1);
  tableBody.innerHTML = "";

  rows.forEach(row => {
    const cols = row.split(",");

    if (!cols[1] || !cols[4]) return; // skip empty rows

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${cols[1]?.trim() || "-"}</td>
      <td>${cols[4]?.trim() || "-"}</td>
      <td>${cols[23]?.trim() || "-"}</td>
      <td>${cols[24]?.trim() || "-"}</td>
    `;

    // M-CAL coloring
    const mcal = tr.children[2].innerText;
    if (mcal.includes("M-S1")) tr.children[2].className = "m-green";
    else if (mcal.includes("M-S2")) tr.children[2].className = "m-blue";
    else if (mcal.includes("M-S3")) tr.children[2].className = "m-yellow";
    else if (mcal.includes("M-S4")) tr.children[2].className = "m-red";

    tableBody.appendChild(tr);
  });

  rowCount.innerText = tableBody.children.length + " rows";
}

searchBox.addEventListener("input", () => {
  const q = searchBox.value.toLowerCase();
  [...tableBody.rows].forEach(r => {
    r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none";
  });
});

loadData();
setInterval(loadData, 60000);
</script>

</body>
</html>
